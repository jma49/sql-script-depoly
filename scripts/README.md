# è„šæœ¬ç›®å½• (Scripts Directory)

è¿™ä¸ªç›®å½•åŒ…å«äº† SQL è„šæœ¬éƒ¨ç½²ç³»ç»Ÿçš„å„ç§å·¥å…·è„šæœ¬ï¼ŒæŒ‰åŠŸèƒ½å’Œæ‰§è¡Œé¢‘ç‡åˆ†ç±»ç»„ç»‡ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
scripts/
â”œâ”€â”€ one-time/              # ä¸€æ¬¡æ€§è„šæœ¬ï¼ˆå·²æ‰§è¡Œçš„åˆå§‹åŒ–å’Œä¼˜åŒ–è„šæœ¬ï¼‰
â”œâ”€â”€ core/                  # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”œâ”€â”€ services/              # æœåŠ¡ç»„ä»¶
â”œâ”€â”€ manage-cache.ts        # ç¼“å­˜ç®¡ç†å·¥å…· â­ å¸¸ç”¨
â”œâ”€â”€ run-sql.ts            # SQLæ‰§è¡Œå·¥å…·
â”œâ”€â”€ run-all-scripts.ts    # æ‰¹é‡è„šæœ¬æ‰§è¡Œå™¨
â”œâ”€â”€ clear-redis-cache.js  # Redisç¼“å­˜æ¸…ç†
â”œâ”€â”€ list-user-roles.js    # ç”¨æˆ·è§’è‰²æŸ¥è¯¢
â””â”€â”€ types.ts              # ç±»å‹å®šä¹‰
```

## ğŸš€ å¸¸ç”¨è„šæœ¬

### ç¼“å­˜ç®¡ç† (æœ€å¸¸ç”¨)

```bash
# æŸ¥çœ‹ç¼“å­˜å¥åº·çŠ¶æ€
npm run cache:health

# æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
npm run cache:stats

# æŸ¥çœ‹ç¼“å­˜ç­–ç•¥é…ç½®
npm run cache:strategies

# æ¸…ç†æ‰€æœ‰ç¼“å­˜
npm run cache:clear

# å®æ—¶ç›‘æ§ç¼“å­˜æ€§èƒ½
npm run cache:monitor
```

### SQL è„šæœ¬æ‰§è¡Œ

```bash
# æ‰§è¡Œå•ä¸ªè„šæœ¬
npm run sql:run [script-name]

# æ‰§è¡Œæ‰€æœ‰å¯ç”¨çš„è„šæœ¬
npm run sql:run-enabled

# æ‰§è¡Œæ‰€æœ‰å®šæ—¶è„šæœ¬
npm run sql:run-scheduled

# æ‰§è¡Œæ‰€æœ‰è„šæœ¬
npm run sql:run-all
```

### æ•°æ®åº“ä¼˜åŒ– (ä¸€æ¬¡æ€§)

```bash
# é¢„è§ˆè¦åˆ›å»ºçš„ç´¢å¼•
npm run optimize:db:dry-run

# ä»…ç”ŸæˆæŠ¥å‘Š
npm run optimize:db:report

# æ‰§è¡Œç´¢å¼•ä¼˜åŒ–
npm run optimize:db
```

## ğŸ“‚ å­ç›®å½•è¯´æ˜

### `/one-time/` - ä¸€æ¬¡æ€§è„šæœ¬

å·²æ‰§è¡Œè¿‡çš„ç³»ç»Ÿåˆå§‹åŒ–å’Œä¼˜åŒ–è„šæœ¬ï¼ŒåŒ…å«å®Œæ•´çš„æ‰§è¡Œè¯´æ˜ã€‚
è¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹ [one-time/README.md](./one-time/README.md)

### `/core/` - æ ¸å¿ƒæ¨¡å—

- `sql-executor.ts` - SQL æ‰§è¡Œå¼•æ“

### `/services/` - æœåŠ¡ç»„ä»¶

- `mongo-service.ts` - MongoDB æœåŠ¡
- `slack-service.ts` - Slack é€šçŸ¥æœåŠ¡

## ğŸ”§ å¼€å‘å·¥å…·

### ç”¨æˆ·ç®¡ç†

```bash
# æŸ¥çœ‹ç”¨æˆ·è§’è‰²
node scripts/list-user-roles.js

# åˆ†é…ç®¡ç†å‘˜è§’è‰² (ä¸€æ¬¡æ€§)
node scripts/one-time/assign-admin-role.js
```

### æµ‹è¯•å’Œè¯Šæ–­

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
npm run test:db

# æµ‹è¯•MongoDBè¿æ¥
npm run test:mongodb

# æµ‹è¯•Slacké€šçŸ¥
npm run test:notify
```

## ğŸ“‹ è„šæœ¬åˆ†ç±»

| ç±»å‹            | æè¿°               | æ‰§è¡Œé¢‘ç‡   |
| --------------- | ------------------ | ---------- |
| ğŸ”„ **è¿ç»´å·¥å…·** | cache ç®¡ç†ã€æ¸…ç†ç­‰ | æ—¥å¸¸ä½¿ç”¨   |
| âš¡ **æ‰§è¡Œå™¨**   | SQL è„šæœ¬è¿è¡Œ       | æŒ‰éœ€ä½¿ç”¨   |
| ğŸ”§ **ä¸€æ¬¡æ€§**   | åˆå§‹åŒ–ã€ä¼˜åŒ–       | ä»…æ‰§è¡Œä¸€æ¬¡ |
| ğŸ› ï¸ **å¼€å‘å·¥å…·** | æµ‹è¯•ã€è¯Šæ–­         | å¼€å‘è°ƒè¯•   |

## âš ï¸ é‡è¦æé†’

1. **ç¯å¢ƒå˜é‡**: ç¡®ä¿ `.env.local` é…ç½®æ­£ç¡®
2. **æƒé™æ£€æŸ¥**: æŸäº›è„šæœ¬éœ€è¦ç®¡ç†å‘˜æƒé™
3. **å¤‡ä»½å»ºè®®**: æ‰§è¡Œé‡è¦æ“ä½œå‰å»ºè®®å¤‡ä»½æ•°æ®
4. **æ—¥å¿—è®°å½•**: ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œæ—¶æ³¨æ„æŸ¥çœ‹æ—¥å¿—è¾“å‡º
